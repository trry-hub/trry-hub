# 💻 系统安装后要做的那些事

---

## 一、常用软件安装（所有平台通用）

### 🌲 Node.js 环境管理（nvm）
1. 安装 [nvm](https://github.com/nvm-sh/nvm)  
2. 安装常用 Node 版本：  
   nvm install 14.17.2  
   nvm install 16.14.2  
3. 在 **Node 14.17.2** 下安装并切换淘宝源：  
   nvm use 14.17.2  
   npm install -g nrm  
   nrm use taobao  
4. 在 **Node 16.14.2** 下安装 `pnpm`：  
   nvm use 16.14.2  
   npm install -g pnpm  

### 🔒 VPN 工具
- **macOS**：[anyconnect-macos](https://cdnfile.yaomaitong.cn/vpn/anyconnect-macos-4.9.04053.dmg)（仅勾选 VPN）  
- **Windows**：[anyconnect_win.zip](https://cdnfile.yaomaitong.cn/vpn/anyconnect_win.zip)  
- **iPhone**：App Store 搜索 **AnyConnect**  
- **Android**：[OpenConnect.apk](https://cdnfile.yaomaitong.cn/vpn/OpenConnect-1.15-1152.apk)  

[提示] 使用 VPN 前先安装个人 `.p12` 文件，然后连接：`vpn.yaomaitong.cn:4433`

### 🖱️ 辅助工具
- Windows 鼠标点击效果：[ClickShow](https://github.com/cuiliang/ClickShow/releases/tag/1.4.1)  
- macOS 鼠标指针：[macOS-cursor](https://zhutix.com/ico/macos-cursor-21/)  
- Windows 鼠标指针：[Windows 指针主题](https://zhutix.com/ico/macos-cursor-21/)  

## 二、分平台配置方案

---

### 🔹 Windows

#### 1. 开机自启动
路径：  
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp  
👉 建议将 **uTools**、**Snipaste** 放入其中。  

#### 2. PowerShell 脚本执行权限
以管理员身份运行 PowerShell：  
```powershell
set-executionpolicy remotesigned
```

#### 3. 安装 WSL
1. 参考安装教程：https://bbs.huaweicloud.com/blogs/350759  
2. 重启后，在 Microsoft Store 中安装：  
   [Windows Subsystem for Linux](https://apps.microsoft.com/store/detail/windows-subsystem-for-linux/9P9TQF7MRM4R)  

#### 4. PowerShell 美化（Oh My Posh）
1. 安装 [Oh My Posh](https://ohmyposh.dev/)  
2. 写入 `$PROFILE`：  
```powershell
oh-my-posh init pwsh --config $env:POSH_THEMES_PATH\M365princess.omp.json | Invoke-Expression
```
3. 字体推荐：**CaskaydiaCove NFM**  
4. 查看主题：  
```powershell
Get-PoshThemes
```

---

### 🔹 macOS

#### 1. Homebrew
安装 [Homebrew](https://brew.sh/)，便于软件包管理。  

#### 2. Zsh 美化
推荐使用 **Starship**：  

```bash
brew install starship
echo 'eval "$(starship init zsh)"' >> ~/.zshrc
```

##### 配置 Starship
创建 `~/.config/starship.toml` 文件并添加以下内容：
```toml
format = ""
""$username\
$git_branch\
$nodejs\
$character"""
# 在提示符之间插入空行
add_newline = false

# 使用内置的username模块而不是env_var
[username]
style_user = "#17A8CD"
format = "[$user](#17A8CD):"
show_always = true

[git_branch]
# 显示当前的 Git 分支
format = "[$branch](#D670D6) "

[nodejs]
# 显示 Node.js 版本
format = "[$version](#23D184) "

[character]
# 确定提示符字符的显示，根据上次命令的成功或失败显示不同的颜色
success_symbol = "[➜](bold green)"
error_symbol = "[➜](bold red)"
```

此配置会显示用户名、Git分支、Node.js版本，并根据命令执行结果显示不同颜色的提示符。

#### 3. 自动切换 Node 版本
在 `~/.zshrc` 添加如下脚本：  

```bash
# nvm 基础配置
eval "$(starship init zsh)"
export PATH="$PATH:/path/to/pnpm"
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
PATH=~/.console-ninja/.bin:$PATH

if [[ -z "$NODE_VERSION_LOGGED" ]]; then
  export NODE_VERSION_LOGGED="true"

  # 彩色输出
  green() { printf "\033[0;32m%s\033[0m\n" "$*"; }
  yellow() { printf "\033[0;33m%s\033[0m\n" "$*"; }
  red() { printf "\033[0;31m%s\033[0m\n" "$*";}

  # 打印最终版本信息
  delayed_log() {
    sleep 0.5
    local node_version=$(node -v 2>/dev/null)
    local npm_version=$(npm -v 2>/dev/null)
    local pnpm_version=""
    if command -v pnpm >/dev/null; then
      pnpm_version=$(pnpm -v)
    fi
    if [ -n "$pnpm_version" ]; then
      green "Now using node $node_version (npm v$npm_version, pnpm v$pnpm_version)"
    else
      green "Now using node $node_version (npm v$npm_version)"
    fi
  }

  # 主逻辑
  load_engines_node() {
    local engine_node_version=""
    local matched_version=""
    local nvm_latest_version=""

    # 读取 package.json 里的 engines.node
    if [ -f "package.json" ]; then
      engine_node_version=$(grep '"node"' package.json | sed -E 's/.*"node": "([^"]+)".*/\1/')
    fi

    if [ -z "$engine_node_version" ]; then
      yellow "⚠️ 未在 package.json 中找到 engines.node，使用 nvm 最新版本..."
      nvm_latest_version=$(nvm ls --no-alias | grep -oE 'v[0-9]+\.[0-9]+\.[0-9]+' | sort -Vr | head -n1)
    else
      echo "🤓 找到 package.json 中 engines.node 的配置版本 ($engine_node_version)，正在尝试切换 Node 版本..."
      # 去掉 v 前缀
      engine_node_version="${engine_node_version#v}"
      # 看看是否有精确匹配
      matched_version=$(nvm ls --no-alias | grep -oE "v$engine_node_version" | head -n1)
    fi

    if [ -n "$matched_version" ]; then
      echo "✅ 找到符合条件的 Node 版本 $matched_version，正在切换..."
      nvm use "$matched_version" > /dev/null
    elif [ -n "$nvm_latest_version" ]; then
      echo "🚀 未找到匹配的 Node 版本，使用最新版本 $nvm_latest_version..."
      nvm use "$nvm_latest_version" > /dev/null
    else
      red "❌ nvm 中未找到合适的 Node 版本，请先执行 nvm install <version>"
      return 1
    fi

    delayed_log
  }

  load_engines_node
fi
```

执行：  
```bash
source ~/.zshrc
```

---

### 🔹 Linux (Ubuntu / Debian 示例)

#### 1. 更新系统
```bash
sudo apt update && sudo apt upgrade -y
```

#### 2. 安装常用工具
```bash
sudo apt install -y curl git vim build-essential
```

#### 3. 安装 Zsh + Starship
```bash
sudo apt install -y zsh
sh -c "$(curl -fsSL https://starship.rs/install.sh)"
echo 'eval "$(starship init zsh)"' >> ~/.zshrc
chsh -s $(which zsh)
```

#### 4. NVM + Node 环境
安装 nvm 并配置到 `~/.zshrc`，可与 macOS 相同。  

---

## 三、字体推荐
- [MiSans](https://web.vip.miui.com/page/info/mio/mio/detail?postId=33935854)  
- [Recursive](https://github.com/arrowtype/recursive)  
- CaskaydiaCove NFM （推荐给 PowerShell / VSCode 使用）

---

## ✅ 总结
本指南分为 **Windows / macOS / Linux 三套独立方案**：  

- 🪟 Windows → PowerShell + WSL + Oh My Posh  
- 🍎 macOS → Zsh + Starship + Node 自动切换  
- 🐧 Linux → Zsh + Starship + 系统工具  

按步骤逐一执行，即可快速完成新机器的开发环境初始化。
